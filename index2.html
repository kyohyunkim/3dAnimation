<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>

<body>
  <div class="contents">
    <div class="wrap">
    <canvas id="hero-lightpass"></canvas>
    </div>
  </div>
  <style>
    html {
      height: 100vh;padding: 0;margin:0;
    }

    body {
      background: #fff;
      overflow: hidden;
      padding: 0;margin:0;
    }
    
    .contents{padding:20px;}
    .wrap{background-color: #000;position: relative;height:300px;padding:30px 0;overflow: hidden;border-radius: 20px;}

    canvas {
      position: absolute;
      left: 49%;
      top: 50%;
      transform: translate(-50%, -50%);
      max-width: calc(100vw - 40px);
      max-height: 100vh;
    }
  </style>
  <script>
    const html = document.documentElement;
    const canvas = document.getElementById("hero-lightpass");
    const context = canvas.getContext("2d");

    const frameCount = 147;
    const currentFrame = index => (
      `https://www.apple.com/105/media/us/airpods-pro/2019/1299e2f5_9206_4470_b28e_08307a42f19b/anim/sequence/large/01-hero-lightpass/${index.toString().padStart(4, '0')}.jpg`
    )

    const preloadImages = () => {
      for (let i = 1; i < frameCount; i++) {
        const img = new Image();
        img.src = currentFrame(i);
      }
    };

    const img = new Image()
    img.src = currentFrame(1);
    canvas.width = 1158;
    canvas.height = 770;
    img.onload = function () {
      context.drawImage(img, 0, 0);
    }

    const updateImage = index => {
      img.src = currentFrame(index);
      context.drawImage(img, 0, 0);
    }

    canvas.addEventListener('touchmove', handleTouchMove);

    function handleTouchMove(event) {
    const { touches } = event;
    if (touches.length === 1) {
        const touch = touches[0];
        const { clientX } = touch;
        const deviceWidth = window.innerWidth;
        const touchFraction = clientX / deviceWidth;
        const frameIndex = Math.min(
        frameCount - 1,
        Math.ceil(touchFraction * frameCount)
        );
        updateImage(frameIndex + 1);
    }
    }

    preloadImages();
  </script>
</body>

</html>